### 2.1 APP 文件
包括以下两个文件
| 文件名 |描述 |
| :-----| :----: |
| dom.css |APP 所有 dom 默认的样式 |
| app_script.js |APP 启动的全局函数和变量|
| app_default.less |APP 默认的less文件|
| resouce.json |多语言包资源文件|

* dom.css <br>
APP 所有 dom 默认的样式

```
div{
    padding-top: 0;
    padding-bottom:0;
    padding-left:0;
    padding-right:0;
    border_width:0; 
}
button{
    padding-top: 0;
    padding-bottom:0;
    padding-left:0;
    padding-right:0;
}
......
```
* app_script.js <br>
APP 启动的全局函数和变量，每个页面都可以访问和更改<br>
APP启动时会自动运行 onload 函数
```
include("message_box.js")
var app_name = "test"
global = {
    abc:"123"
}
//APP 启动时会自动调用这个方法，
function onload()
{
    print(app_name + "start....");
}
......
```
*注 include暂不支持嵌套

### 2.2 页面文件
页面文件包括以下4个文件，
| 文件名 |描述 |
| :-----| :----: |
| layout.xml |排版页面，html格式 |
| style.css |当前页面的样式表|
| style.less |当前页面的样式表 less格式，less文件和css文件只能有一个，less文件会自动编译成css覆盖，|
| script.js |脚本文件|

页面跳转后，页面信息都会被销毁

* layout.xml 例子

```
<div class="top">
    <div class="progress">
        <div class="left_progress">
            <bar :value="left_value" max_value="10" width="90" height="20" />
            <div class="txt">
                <label :text="leftaddten" :y="left_y"/>
            </div>                
        </div>
        <div class="space"> 
            <label text="09:00" />
        </div>
        <div class="right_progress">
            <div class="txt">
                <label :text="rightaddten" :y="right_y" />        
            </div>                
            <bar class="right_bar" :value="right_value" max_value="10" width="90" height="20"/>
        </div>
    </div>
<div>    
```
* style.css 例子

```
.top{
    width: 100%;
    height: 100%;    
    display: flex;
    flex-flow: row wrap;  
    align-items:center;       
}

.progress{
    width: 100%;
    height: 30;
    display: flex;
    flex-flow: column wrap;      
    justify-content:space-between; 
    align-items: center;    
}

.left_progress{
    width: 140;
    height: 30;
    display: flex;
    flex-flow: column wrap;      
    justify-content:flex-start;    
    align-items: center;    
}

......
```

* data.json 例子

```
{
    "left_value":"4",
    "right_value":"1",
    "result":"",
    "cn_label":"",
	"fs_points":[
        {"x":1, "y":1}, 
        {"x":30, "y":1}
    ],
    "q_list":[]
}

```

* script.js 例子

**script.js 所有的属性和方法（函数）都必须放在 页面命名的一个json变量 <br>**
**例如 koushuan页面，必须是 koushan = {}，主要是方便引擎销毁 <br>**
**页面启动时会自动运行onload的方法 koushan = {onload:function(...){}}， 页面参数会通过onload 传入 详细传入方法参考 gu_ui.jumpPage<br>**
**页面销毁时会自动运行destory的方法 

```
koushuan = {
    data:{
        left_value:4,
        right_value:1,
        result:"",
        cn_label:"",
    	fs_points:[
            {"x":1, "y":1}, 
            {"x":30, "y":1}
        ],
        "q_list":[]
            yes_no:"",
        left_value:0,
        right_value:0,
        cur_index:3,
    },
    onload:function(){
        this.get_one_ques(this.data.cur_index);
    },
    destory:function(){
         console.log("destory......")
     },
    get_one_ques:function(index){
        one = this.data.q_list[index];
        gu_ui.varsetJSON("local_path", JSON.stringify(one.q))
        gu_ui.ArrayReplace('q_list', 'local_path');
        gu_ui.varset("q_list[4].fz_focus", "focused")
    },
    get_cur_question:function(){
        return this.data.all_question[this.data.cur_index]
    }, 
    value_changed:function(){
        if(this.answer == ''){
            return;
        }
        if(this.answer == this.get_cur_question().answer ){
            this.left_value++;
            this.cn_label = "cn_label_yes"
            this.leftaddten = "+10"
            this.rightaddten = ""
            this.result = "61452"
            this.start_anim("left_y");            
        }else{
            this.cn_label = "cn_label_yes"
            this.leftaddten = ""
            this.rightaddten = "+10"
            this.result = "61453"
            this.start_anim("right_y);           
        }
    }
}
```

### 2.3 APP的目录结构
一个APP包含多个页面文件，每个页面时页面名称创建一个目录，例如一个APP应用的文件结构如下
```
math                                 APP根目录必须是应用名称加上
├── pages                                      页面目录 
       ├── index                               APP默认页面 必须是index 
               ├── layout.xml                      页面排版，html格式
               ├── style.css                       当前页面的样式表
               └── script.js                       当前页面脚本文件
        ├── koushuan                            页面名称  
               ├── layout.xml                           
               ├── style.css     
               └── script.js           
├── assets                                    资源目录
         ├── images                          图片目录
         ├── audio                            音频目录
├── dom.css                                 所有dom默认的样式
├── app_script.js                           app全局javascript
├── resouce.json                           app的资源文件
├── app_default.less                      app的默认less
├── sync.json                                当前app依赖的文件列表
├── channel_resouce                     渠道目录
         ├── standard.                       渠道名称目录                        
                  ├──  images                         当前渠道图片目录
                  ├── audio                            当前渠道音频目录
                  ├── resouce.json                  当前渠道资源文件
                  ├── app_default.less              当前渠道默认less
                  ├── drv_cfg                          当前渠道的驱动


  ```    
sync.json  文件格式如下：
  ```
[
    {"local":"math_liteapp/code"},
    {"local":"math_liteapp/assets/images"},
    {"local":"math_liteapp/assets/audio"},
    {"local":"font.bin"},
    {"local":"font14.bin"},
    {"local":"font16.bin"},
    {"local":"font24.bin"},
    {"local":"font28.bin"},
    {"local":"drv_cfg"}
]

  ```

### 2.4 APP打包文件
APP完成打包后输出3个文件，目录和文件结构如下：
 ```    
├── code                                      代码文件 
├── assets                                    资源目录
         ├── images                          图片文件
         ├── audio                            音频文件
 ```    
打包步骤如下：

### 1. 建立APP的“打包工作目录(tempAPP)”
    1.1. 将APP的所有文件复制到“打包工作目录(tempAPP)”
    1.2. 将当前渠道资源目录（channel_resouce）覆盖“打包工作目录(tempAPP)”

### 2. 处理APP文件
    2.1. 将APP默认css（dom.css）转成json（defaultcss.json）

* 如果有less文件，先将less转成css
* xz压缩defaultcss.json

2.2. 处理app_script.js
* 预处理（将include文件拼成一个文件）
* xz压缩app_script.js

2.3. 处理多语言资源文件 （resource.json）
* xz压缩resource.json

#### 3. 遍历pages目录下所有页面

3.1. 处理页面的css文件（style.css）
* 如果是less文件，转成css
* 转成style.json

3.2. 处理页面的layout文件（layout.xml)
* 转成layout.json

3.3. 处理页面的data文件（data.json）
* 如果没有data文件，读取页面script.js的data属性转成data.json

3.4. 将style.json、layout.json、data.json 变成一个json(layout)
* xz压缩layout

3.5. 处理页面的js脚本
* xz压缩script.js

#### 4. 合并输出3个文件
    4.1. code
        将app和所有页面的文件合并为code
    4.2. assets/images
        如果image有bin文件，压缩成bin.xz
    4.3. assets/audios
