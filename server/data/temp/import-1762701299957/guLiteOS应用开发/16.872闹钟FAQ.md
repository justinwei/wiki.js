## 擦除FLASH

### 注意事项

* 擦除模式选择 4k。64k 擦除不是完全的，在做bin或者验证的时候，擦除和读写都要选择 4k 的模式。

### 8M flash擦除地址

**flash 全擦**

* 地址：0x000000

* 长度：0x800000

**擦除 kv**

* 地址：0x300000

* 长度：0x10000

**擦除 lfs**

* 地址：0x310000

* 长度：0x4F0000

**擦除 lfs 和 kv**

* 地址：0x300000

* 长度：0x500000

### 16M flash擦除地址

**flash 全擦**

* 地址：0x000000

* 长度：0x1000000

**擦除 kv**

* 地址：0x300000

* 长度：0x10000

**擦除 lfs**

* 地址：0x310000

* 长度：0xCEC000

**擦除lfs和kv**

* 地址：0x300000
* 长度：0xCFC000

## T 卡 ADC 检测插拔

### 说明

* 部分设备通过检测 T 卡检测引脚的 ADC 值判断插拔状态。
* 调试时将驱动等级调到 2 （debug），通过每秒一次的 log 观察 ADC 值变化，看是否在检测范围内。

### ADC 值

插电 插卡：理论值 2768，检测范围 2300-2900

插电 拔卡：理论值 3470，检测范围 > 2900

拔电 插卡：理论值 3542，检测范围 3200-3800

拔电 拔卡：理论值 3542，检测范围 > 3700

## 录音测试

### 测试准备

测试前需要确保设备没有录音噪音问题：测试步骤：

1. 设备插上T卡，开机。
2. 串口输入 lfs kv_set save_tts_pcm 1
3. 进入语音对话，此时会把当前的语音对话保存到T卡，命名为record_sessionID.pcm。
4. 不需要保存录音，串口输入 lfs kv_set save_tts_pcm 0
5. 将 record_sessionID.pcm 文件放到电脑上，听是否有噪音，有噪音的设备不能用于测试。

## 串口命令

### 文件操作

```
fs cp /lfs/drv_cfg /fatfs/drv_cfg

fs open /lfs/app_config.json
fs close

fs rm /lfs/test.json

fs ls /lfs                              # flash app分区
fs ls /fatfs                            # sd卡分区
```

### LED 灯光调试

设置pwm_led颜色（一个pwm灯）：

```
test pwm_led_show 10 10
```

设置pwm_led颜色（两个pwm灯）

```
test pwm_led_show 10
```

设置rgb_led颜色：

```
test rgb_led_show 100 30 92
```

### 保存ota配置文件

```
test ota_debug fatfs
```

### 打开/关闭 CPU 信息

```sh
cpu init p=1                            # 打开
cpu deinit                              # 关闭
```

### 查看线程列表

```sh
thread list
```

### KV 操作

```sh
lfs kv                                  # 查看kv库数据
lfs kv_set save_tts_pcm 1               # 设置kv库数据
```

### 内存操作

```sh
gulite mem                              # 打印引擎内存
gulite show_mem                         # ui显示引擎内存
gulite hide_mem                         # ui关闭引擎内存
psram space                             # 打印psram
heap space                              # 打印sram
```

### 日志等级操作

```sh
log set_level 4                         # 引擎log，4-error，3-warn，2-info，1-debug
log open_js_app 0                       # JS log，0-全部打开
log set_drv_level 2                     # 驱动log，5-error，4-warn，3-info，2-debug，1-verb
```

### 网络操作

wifi 配网方式1：

```
net sta config gurobot 76876868
net sta enable
```

wifi 配网方式2：

```
test wifi connect gurobot 76876868
```

网络下载：

```sh
fs download http://192.168.11.148:8085/lfs/aa.gcmb /lfs/aa555.gcmb
fs download http://192.168.56.102:8085/lfs/microapp_settings.gupkg /lfs/microapp_settings.gupkg
```

ping 网络：

```sh
net ping 192.168.10.254
net ping 192.168.2.59
net ping 192.168.56.102
```



