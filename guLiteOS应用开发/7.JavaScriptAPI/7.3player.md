# 一、参数以及api描述
### API 介绍
#### player.createPlayer()
创建播放器的函数，并始终返回一个 mediaplayer 对象。

#### mediaplayer 事件
当创建成功后，返回的 mediaplayer 对象可通过 on 方法监听多个事件，业务逻辑可在监听的回调函数中完成。以下列举一些常用的事件：
* player_start
##### 当播放开始时触发，参数为 options, options是一个obj
```
mediaPlayer.on('player_start', function(options) {
    console.debug('player_start');
});
```
下面列举支持的 Option对象中的属性值：
    * pasued: int 是否暂停，1表示暂停，0表示不暂停；
    * play_ofs: int 当前歌曲的偏移量（ms）
    * total_ofs: int 当前播放歌曲的总时长（ms）
    * stop_state: int 播放状态
        * 0: pause
        * 1: playing
        * 2: perparing
        * 3: perpared
        * 4: stoped
        * 5: resume
        * 6: init
        * 7: none
        * 8: completed
        * 9: error
    * block: int 是否阻塞播放（不阻塞）
    * url: string 歌曲播放路径
    * name: string 歌曲名字

* player_process
##### 播放过程触发，1秒一次，参数为 options, options是一个obj，描述见事件player_start
```
mediaPlayer.on('player_process', function(options) {
     console.debug('player_process');
});
```
* player_end
##### 播放停止触发，参数为 options, options是一个obj，描述见事件player_start
```
mediaPlayer.on('player_end', function(options) {
     console.debug('player_end');
});
```

* player_error
##### 播放失败触发，参数为 options, options是一个obj，描述见事件player_start
```
mediaPlayer.on('player_error', function(options) {
  console.debug('player_error');
});
```

#### mediaplayer 方法
mediaplayer 除监听事件外，也内置一些方法，用来进行控制播放器，以下列举一些常用的方法。

* ```mediaplayer.play(url, option)```
开始播放的函数。第一个参数传入一个 URL 值，URL 可以是以下协议：http、https、lfs、lfs_ota、fatfs。然后再传入一个 Option 对象，用于配置 player播放时的选项。下面列举支持的 Option对象中的属性值：
    * Option：
      * name: 字符串，歌曲名字
      * audioInfo：
              format: 字符串，数据格式，例如wav、MP3等,
              channel: int 流的通道数,   
              bit: int 流的位宽, 
              samp: int 流的采样率；

* ```mediaplayer.stop()```
停止播放的函数。

* ```mediaplayer.pause()```
暂停播放的函数。

* ```mediaplayer.resume(url)```
恢复播放的函数。第一个参数传入一个 URL 值，URL 可以是以下协议：http、https、lfs、lfs_ota、fatfs

* ```mediaplayer.seek(offset)```
设置位置播放的函数，参数 offset 为毫秒。

* ```mediaplayer.putStream(buffer_data, len, option)```
推流，参数解析如下。
   * buffer_data：一个Buffer，数据；
   * len：数据长度；


### 例子1，正常播放
```
var player = require('player');

const audioUrl = "http://ota.aidoor.net/mp3/voicechange/1.mp3"

var option = {
    name: "abcdef"
}

var mediaPlayer = player.createPlayer();

mediaPlayer.on('player_error', function(options) {
  console.debug('player_error cb');
});

mediaPlayer.on('player_start', function(options) {
    console.debug('player_start');
});

mediaPlayer.on('player_process', function(options) {
    console.debug('player_process:', typeof(options), options);
});

mediaPlayer.on('player_end', function(options) {
    console.debug('player_end');
});

var test = function() {
    function pause() {
        mediaPlayer.pause();
    }
    setTimeout(pause, 1 * 10000);

    function resume() {
        mediaPlayer.resume(audioUrl);
    }
    setTimeout(resume, 2 * 10000);

    function seek() {
        mediaPlayer.seek(12000);
    }
    setTimeout(seek, 2 * 10000);

    function stop() {
        mediaPlayer.stop();
    }
    setTimeout(stop, 3 * 10000);
}
mediaPlayer.play(audioUrl, option);
test();
```

### 例子2，流播放
```
var player = require('player');

var option = {
    name: "abcdef",
    audioInfo: {
	format: 'wav',
	channel: 1,
	bit: 16,
	samp: 16000,
    }   
}

var mediaPlayer = player.createPlayer();

mediaPlayer.on('player_error', function(options) {
  console.debug('player_error cb');
});

mediaPlayer.on('player_start', function(options) {
    console.debug('player_start');
});

mediaPlayer.on('player_process', function(options) {
    console.debug('player_process:', typeof(options), options);
});

mediaPlayer.on('player_end', function(options) {
    console.debug('player_end');
});

var timer_handle;

var fs = require('fs');

var fd = fs.openSync("fatfs/tts_1_ff3636f23a10682dd47a76082059439e.wav", "r");
console.log("openSync fd = ", fd);
var buffer = Buffer(4096);

var options = {
	offset: 0,
	length: 4096,
	position: null,
};

var read = function() {
	options.offset = 0;
	options.length = 4096;
	options.position = null;
	var read_len = fs.readSync(fd, buffer, options);
	console.log('read_len = ', read_len);
	if (read_len == 0) {
		buffer = null;
		fs.closeSync(fd);
		clearInterval(timer_handle);
	}
	var ret = mediaPlayer.putStream(buffer, read_len); //buffer：null || read_len：0 表示最后一帧
}

mediaPlayer.play('this is a stream player', option); //表示流播放

timer_handle = setInterval(read, 100);

```

# 二、ubuntu安装ffmpeg

1、官网下载源码：https://ffmpeg.org/

2、解压源码：tar -xvf 源码

3、执行configure文件，配置需要的功能，建议加上如下选项

```c
./configure --enable-shared --enable-gpl --enable-libass --enable-libfreetype --enable-libmp3lame --enable-libopus --enable-libvorbis --enable-libvpx --enable-libx264 --enable-libx265 --enable-nonfree --enable-pthreads --enable-protocols --enable-demuxers --enable-decoders --enable-debug --disable-optimizations --disable-stripping --enable-openssl --enable-bsf=extract_extradata
```

4、执行make

5、执行sudo make install

6、配置环境变量

```c
sudo vim /etc/ld.so.conf
```

在文件中增加一行：

```c
/usr/local/lib/
```
然后执行ldconfig更新环境变量
7、执行ffmpeg命令，确认安装成功

安装成功后库文件在/usr/local/lib，头文件在/usr/local/include

# 三、macOS安装ffmpeg

brew install ffmpeg